<mat-card-title mat-dialog-title class="d-flex align-items-center justify-content-center">
  <span>{{ tarefa.titulo }}</span>
</mat-card-title>

<mat-dialog-content class="d-flex gap-3">

  <!-- Subtarefas -->
  <mat-card class="p-3 flex-fill bg-body-secondary">
    <!-- Cabeçalho -->
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h3 class="mb-0">Subtarefas</h3>

      <button mat-mini-fab matTooltip='Nova subtarefa' (click)="mostrarInput = !mostrarInput"
        class="app-custom-button-color mat-elevation-z0">
        <mat-icon>add</mat-icon>
      </button>
    </div>

    <!-- Input de nova subtarefa -->
    <div *ngIf="mostrarInput" class="d-flex gap-2 align-items-start mb-2">
      <mat-form-field appearance="outline" class="flex-fill">
        <mat-label>Título da subtarefa</mat-label>
        <input matInput [(ngModel)]="inputSubtarefa" />
      </mat-form-field>

      <button mat-flat-button color="primary" (click)="adicionarSubtarefa()"
        class="app-custom-button-color mat-elevation-z0">
        Adicionar
      </button>
    </div>

    <!-- Lista de subtarefas -->
    <div class="d-flex flex-column gap-2 overflow-y-auto" style="max-height: 300px;">
      <div *ngFor="let sub of tarefa.subtarefas"
        class="d-flex justify-content-between align-items-center p-2 border rounded subtarefa-card" [ngClass]="{
      'subtarefa-concluida': sub.finalizada,
      'subtarefa-pendente': !sub.finalizada
    }">
        <!-- Área de título / edição -->
        <div class="flex-fill">
          <!-- Modo edição -->
          <div *ngIf="subtarefaEmEdicao?.id === sub.id; else visualizacao">
            <mat-form-field class="w-100">
              <input matInput [(ngModel)]="tituloEditando" />
            </mat-form-field>
          </div>

          <!-- Modo visualização -->
          <ng-template #visualizacao>
            <strong [class.text-decoration-line-through]="sub.finalizada" [class.text-muted]="sub.finalizada">
              {{ sub?.titulo }}
            </strong>
          </ng-template>
        </div>

        <!-- Botões -->
        <div class="d-flex gap-2 m-3">
          <!-- Edição -->
          <ng-container *ngIf="subtarefaEmEdicao?.id === sub.id; else botoesNormais">
            <button mat-icon-button class="btn-acao editar" matTooltip="Salvar edição" (click)="salvarEdicao(sub)">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button class="btn-acao excluir" matTooltip="Cancelar edição" (click)="cancelarEdicao()">
              <mat-icon>close</mat-icon>
            </button>
          </ng-container>

          <!-- Botões normais -->
          <ng-template #botoesNormais>
            <button mat-icon-button class="btn-acao editar" matTooltip="Editar subtarefa" (click)="editarSubtarefa(sub)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button class="btn-acao excluir" matTooltip="Excluir subtarefa" (click)="excluirSubtarefa(sub)">
              <mat-icon>delete</mat-icon>
            </button>

            <button mat-icon-button class="btn-acao acao" [color]="sub.finalizada ? 'accent' : 'success'"
              [matTooltip]="sub.finalizada ? 'Reabrir subtarefa' : 'Finalizar subtarefa'" (click)="alterarStatus(sub)">
              <mat-icon>{{ sub.finalizada ? 'restart_alt' : 'done' }}</mat-icon>
            </button>
          </ng-template>
        </div>
      </div>
    </div>

  </mat-card>
</mat-dialog-content>

<mat-dialog-actions>
  <button mat-button type="button" class="col-sm-4 app-custom-button-color"(click)="fechar()">Fechar</button>
</mat-dialog-actions>
